<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Investments List</title>
    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">
	  <link href="css/bootstrap.min.css" rel="stylesheet">
	  <link href="css/style.css" rel="stylesheet">
  </head>
  <body>

    <div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<h2>
				List of Investments
			</h2>
			<h5>Total Amount Invested: <td th:text="${#numbers.formatCurrency(totalAmountInv)}"></td> </h5>
			<h5>Remaining Amount: <td th:text="${#numbers.formatCurrency(remainingAmt)}"></td> </h5>

			<div class = "filter-controls">
				<label for="sortOption">Sort by: </label>
				<select id="sortOption">
					<option value="amountAsc">Amount (Low to High)</option>
					<option value="amountDesc">Amount (High to Low)</option>
					<option value="nameAsc">Stock Name (A to Z)</option>
					<option value="nameDesc">Stock Name (Z to A)</option>
				</select>
			</div>
			<script>
				$(document).ready(function() {
					console.log("Document ready");
					// define the select element
					sortOption = $('#sortOption');

					// Function to handle the change event
					function handleSortOptionChange() {
						const option = sortOption.val();
						console.log("handlesortoption change");
						sortStocks(option);
					}

					// Add an event listener for the change event
					sortOption.on('change', handleSortOptionChange);

					// Trigger the change event when the page loads or after defining the event listener
					handleSortOptionChange();

					// $('#sortOption').change(function() {
					// 	const option = $(this).val();
					// 	sortStocks(option);



				function sortStocks(option) {
					console.log('option:', option);
					const stockTable = $('.table tbody');
					const rows = stockTable.children('tr').get();

					rows.sort(function (a, b) {
						const keyA = $(a).attr('data-key');
						const keyB = $(b).attr('data-key');
						console.log('keyA:', keyA);
						console.log('keyB:', keyB);
						if (option === 'amountAsc') {
							return keyA - keyB;
						} else if (option === 'amountDesc') {
							return keyB - keyA;
						} else if (option === 'nameAsc') {
							return keyA.localeCompare(keyB);
						} else if (option === 'nameDesc') {
							return keyB.localeCompare(keyA);
						}
					});
					stockTable.empty();
					$.each(rows, function(index, row) {
						stockTable.append(row);
					});
				}
			</script>

			<table class="table table-hover table-striped">

				<thead>
					<tr>
						<th>id</th>
						<th>Stock</th>
						<th>Amount Invested</th>
						<th>Edit</th>
						<th>Delete</th>
					</tr>

				</thead>
				<tbody>
					<tr th:each = "stock : ${stocks}" th:data-key="${stock.amountInv + '-' + stock.stockName}">
						<td th:text="${stock.id}"></td>
						<td th:text="${stock.stockName}"></td>
						<td th:text="${#numbers.formatCurrency(stock.amountInv)}"></td>

						<td>
							<a th:href="@{'/editStock/' + ${stock.id}}" class="btn btn-primary">View/Edit</a>

						</td>
						<td>
							<a th:href="@{'/deleteStock/' + ${stock.id}}" class="btn btn-danger">Delete</a>
						</td>
					</tr>
				</tbody>
			</table>
			<!--
			No button yet
			-->
			<a th:href="@{/addStock}" class="btn btn-success">Add Stock / Inv</a>

		</div>
	</div>
</div>

	<script src="js/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script src="js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>

  </body>
</html>