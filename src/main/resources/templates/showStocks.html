<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Investments List</title>
    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">
	  <link href="css/bootstrap.min.css" rel="stylesheet">
	  <link href="css/style.css" rel="stylesheet">
  </head>
  <body>

    <div class="container-fluid">
	<div class="row">
		<div class="col-md-12">
			<h2>
				List of Investments
			</h2>
			<h5>Total Amount Invested: <td th:text="${#numbers.formatCurrency(totalAmountInv)}"></td> </h5>
			<h5>Remaining Amount: <td th:text="${#numbers.formatCurrency(remainingAmt)}"></td> </h5>
			<table class="table table-hover table-striped">
				<thead>
					<tr>
						<th class="sortable" data-sort="id">ID</th>
						<th class="sortable" data-sort="stockName">Stock</th>
						<th class="sortable" data-sort="amountInv">Amount Invested</th>
						<th>Edit</th>
						<th>Delete</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each = "stock : ${stocks}" th:data-key="${stock.amountInv + '-' + stock.stockName}">
						<td th:text="${stock.id}"></td>
						<td th:text="${stock.stockName}"></td>
						<td th:text="${#numbers.formatCurrency(stock.amountInv)}"></td>

						<td>
							<a th:href="@{'/editStock/' + ${stock.id}}" class="btn btn-primary">View/Edit</a>

						</td>
						<td>
							<a th:href="@{'/deleteStock/' + ${stock.id}}" class="btn btn-danger">Delete</a>
						</td>
					</tr>
				</tbody>
			</table>
			<a th:href="@{/addStock}" class="btn btn-success">Add Stock / Inv</a>
		</div>
	</div>
</div>

	<script src="js/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>
  </body>
</html>

	<script>
		$(document).ready(function() {
			console.log("HTML:Document ready");
			// Click event handler for column headers
			$('.sortable').on('click', function(e) {
				e.preventDefault();
				const field = $(this).data('sort'); // Get the field to sort
				console.log("HTMLField: ", field);
				const sortOrder = $(this).hasClass('ascending') ? 'descending' : 'ascending';
				console.log("sortOrder: ", sortOrder);
				// Toggle the class and sort arrow icon
				$('.sortable').removeClass('ascending descending');
				$(this).addClass(sortOrder);

				// Call an API endpoint to fetch sorted data and update table
				fetchSortedData(field, sortOrder);
			});

			function fetchSortedData(field, sortOrder) {
				console.log("HTML:In fetchSortedData");
			// Make an AJAX request to API to get sorted data
				$.get('/stock/' + field + '/' + sortOrder, function(data) {
					updateTable(data);
					// Update table with sorted data
					// Now use jQuery to update table
				});
			}

			function updateTable(data) {
				console.log("HTML:In updateTable");
				var tableBody = $('.table tbody');
				tableBody.empty();
				data.forEach(function (item) {
					var row = '<tr>' +
							'<td>' + item.id + '</td>' +
							'<td>' + item.stockName + '</td>' +
							'<td>' + item.amountInv + '</td>' +
							'<td><a href="/editStock/' + item.id + '" class="btn btn-primary">View/Edit</a></td>' +
							'<td><a href="/deleteStock/' + item.id + '" class="btn btn-danger">Delete</a></td>' +
							'</tr>';
					tableBody.append(row);
				});
			}
		});
	</script>


